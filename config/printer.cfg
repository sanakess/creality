# K1-MAX
# Printer_size: 300x300x300
# Version: v1.0.30
# CreateDate: 2023/03/21
# Nozzle_mcu: chip: GD32F303CBT6
#             version: K1-NOZZLE-M_V12
# Leveling_mcu: chip: GD32E230F8P6
#             version: K1-MAX-L-V11
# mcu: chip: GD32F303RET6
#      version: CR4CU220812S12

[include sensorless.cfg]
[include client.cfg]

[include internal_macros.cfg]

[include useful_macros.cfg]

[include start_end.cfg]

[include Line_Purge.cfg]

[include Smart_Park.cfg]

[include fan_control.cfg]

[include guppyscreen.cfg]

[include quickstart.cfg]

[include cartotouch_macro.cfg]

[include cartotouch.cfg]

[include cartographer_calibrate.cfg]
#[include advanced_nozzle_cleaner.cfg]
[include advanced_nozzle_cleaner.cfg]

[mcu]
serial: /dev/ttyS7
baud: 230400
restart_method: command

[mcu nozzle_mcu]
serial: /dev/ttyS1
baud: 230400
restart_method: command

[verify_heater extruder]
[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[gcode_arcs]
resolution: 1.0

[stepper_x]
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
microsteps: 32
rotation_distance: 40
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 306.5
position_min: -2
position_max: 306.5
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PA9
interpolate: True
run_current:1.2
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB12
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 85
# hold_current:1.0

[stepper_y]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
microsteps: 32
rotation_distance: 40
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -2
position_min: -2
position_max: 306
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PA10
interpolate: True
run_current:1.2
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB13
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 85
# hold_current:1.0

[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin: probe:z_virtual_endstop
position_max: 302
position_min: -10
homing_speed: 10
second_homing_speed: 1
# position_endstop: 0
homing_retract_dist: 2.0
# homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PA11
uart_address: 3
run_current: 0.8
diag_pin: ^PB14
stealthchop_threshold: 0
#stealthchop_threshold: 999999
sense_resistor: 0.100
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: nozzle_mcu:PB1
dir_pin: nozzle_mcu:PB0
enable_pin: !nozzle_mcu:PB2
microsteps: 16
rotation_distance: 6.9
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: nozzle_mcu:PB7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: nozzle_mcu:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
#control: pid
#pid_Kp: 25.013
#pid_Ki: 2.566
#pid_Kd: 60.966
min_temp: 0
max_temp: 320

[tmc2209 extruder]
uart_pin: nozzle_mcu:PB11
tx_pin: nozzle_mcu:PB10
uart_address: 3
run_current: 0.55
sense_resistor: 0.150
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

[heater_bed]
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
#control: pid
#pid_Kp: 37
#pid_Ki: 0.18
#pid_Kd: 280
min_temp: 0
max_temp: 125

[filament_switch_sensor filament_sensor]
pause_on_runout: true
switch_pin: !PC15
runout_gcode: _ON_FILAMENT_RUNOUT

[filament_switch_sensor filament_sensor_2]
pause_on_runout: true
switch_pin: !nozzle_mcu:PA10

[output_pin LED]
pin:PB0
pwm: True
cycle_time: 0.010
value: 0

[adxl345]
cs_pin: nozzle_mcu:PA4
spi_speed: 5000000
axes_map: x,-z,y
spi_software_sclk_pin: nozzle_mcu:PA5
spi_software_mosi_pin: nozzle_mcu:PA7
spi_software_miso_pin: nozzle_mcu:PA6

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 75
# min_freq: 30
# max_freq: 100
probe_points:
   150,150,10

[printer]
kinematics: corexy
max_velocity: 800
max_accel: 20000
max_z_velocity: 20
square_corner_velocity: 5.0
max_z_accel: 300
# square_corner_max_velocity: 200.0
# max_accel_to_decel: 20000

[scanner]
#scanner_touch_z_offset: 0.05
mode: touch

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.3982625857511575,
#*# 	1.7919226955528638,
#*# 	0.7283013318865882,
#*# 	0.40080752429167776,
#*# 	0.37472540110093283,
#*# 	0.2569805600708241,
#*# 	-0.16849822123043984,
#*# 	-0.11648254619638079,
#*# 	0.2176432814519313,
#*# 	0.1187376649762911
#*# model_domain = 3.186808251708748e-07,3.314790587285407e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 44.799788
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER K1 5.1.0
#*#
#*# [scanner]
#*# scanner_touch_threshold = 2750
#*# scanner_touch_speed = 2
#*# scanner_touch_z_offset = 0.110
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.007499, -0.004378, -0.003121
#*# compensation_start_x = 10.0
#*# compensation_end_x = 280.0
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 47.235
#*# pid_ki = 3.057
#*# pid_kd = 182.446
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.238
#*# pid_ki = 2.544
#*# pid_kd = 78.359
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 53.8
#*# shaper_type_y = zv
#*# shaper_freq_y = 57.8
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.063948, 0.053947, 0.066000, 0.072130, 0.074961, 0.077772, 0.078779, 0.082460, 0.079182, 0.076131, 0.074844, 0.079147, 0.080604, 0.080142, 0.079350, 0.080336, 0.081475, 0.085854, 0.082229, 0.072155
#*# 	  0.064045, 0.055913, 0.091121, 0.098085, 0.106598, 0.100760, 0.097574, 0.101059, 0.097145, 0.096708, 0.092176, 0.096611, 0.090716, 0.086740, 0.085943, 0.085276, 0.082554, 0.077792, 0.055735, 0.054084
#*# 	  0.095056, 0.112465, 0.116977, 0.126817, 0.128918, 0.125328, 0.124685, 0.124236, 0.121725, 0.118534, 0.113020, 0.108431, 0.107268, 0.102176, 0.101429, 0.099043, 0.096502, 0.092689, 0.082695, 0.068311
#*# 	  0.095994, 0.110938, 0.120011, 0.130197, 0.130066, 0.128708, 0.125503, 0.126499, 0.120252, 0.114718, 0.108258, 0.102960, 0.098843, 0.094506, 0.090078, 0.089824, 0.090308, 0.074134, 0.072692, 0.050614
#*# 	  0.073284, 0.080362, 0.092105, 0.101048, 0.098529, 0.101034, 0.096627, 0.092144, 0.087208, 0.089329, 0.073748, 0.064853, 0.063559, 0.059007, 0.060305, 0.053747, 0.044435, 0.040625, 0.037257, 0.021645
#*# 	  0.048308, 0.058509, 0.072271, 0.076961, 0.077756, 0.077465, 0.078547, 0.076149, 0.070541, 0.060394, 0.067165, 0.045618, 0.039498, 0.045250, 0.048066, 0.042737, 0.023056, 0.009158, 0.011887, -0.015980
#*# 	  0.035261, 0.058019, 0.068875, 0.076164, 0.078862, 0.077491, 0.086566, 0.073673, 0.065930, 0.053910, 0.044850, 0.040128, 0.032428, 0.030974, 0.024977, 0.014382, -0.001272, -0.013335, -0.019813, -0.042981
#*# 	  0.045700, 0.060091, 0.073228, 0.080953, 0.080976, 0.075473, 0.067651, 0.061342, 0.052956, 0.046330, 0.038351, 0.028520, 0.016750, 0.015401, 0.012109, 0.011026, -0.006424, -0.027482, -0.031885, -0.059556
#*# 	  0.028303, 0.036800, 0.045301, 0.059530, 0.060440, 0.052081, 0.032607, 0.033132, 0.028798, 0.023057, 0.019726, 0.008525, -0.006387, -0.014240, -0.022960, -0.029335, -0.046892, -0.068087, -0.071070, -0.091193
#*# 	  0.011789, 0.030202, 0.036064, 0.038580, 0.044598, 0.035970, 0.030643, 0.023781, 0.021411, 0.009627, 0.001248, -0.007507, -0.020792, -0.035487, -0.048074, -0.062504, -0.081027, -0.092464, -0.091112, -0.117371
#*# 	  0.008353, 0.030322, 0.040961, 0.043785, 0.045408, 0.036699, 0.032871, 0.025303, 0.019358, 0.015205, 0.010946, -0.001104, -0.018424, -0.032595, -0.042390, -0.054746, -0.075123, -0.088797, -0.095580, -0.120221
#*# 	  0.030414, 0.057150, 0.073544, 0.081374, 0.075384, 0.070734, 0.063138, 0.064650, 0.057541, 0.050753, 0.042232, 0.030364, 0.014973, -0.000956, -0.012219, -0.023928, -0.042975, -0.066733, -0.067635, -0.090929
#*# 	  0.048076, 0.073238, 0.081746, 0.091759, 0.095873, 0.093074, 0.083540, 0.088334, 0.077250, 0.070668, 0.060156, 0.046407, 0.038731, 0.016095, 0.009112, -0.007409, -0.029148, -0.044043, -0.051530, -0.069815
#*# 	  0.066308, 0.076171, 0.070970, 0.088688, 0.087319, 0.083283, 0.082844, 0.081156, 0.072438, 0.062131, 0.051384, 0.040526, 0.030186, 0.020067, 0.007197, -0.003491, -0.030038, -0.047419, -0.048329, -0.071501
#*# 	  0.067007, 0.076882, 0.085898, 0.095805, 0.099232, 0.089758, 0.096482, 0.100624, 0.081177, 0.069839, 0.059726, 0.049394, 0.035937, 0.027297, 0.014607, 0.002603, -0.012577, -0.026139, -0.035545, -0.059404
#*# 	  0.071558, 0.085340, 0.101464, 0.106344, 0.112368, 0.101109, 0.103238, 0.104650, 0.095720, 0.087183, 0.080132, 0.066778, 0.053959, 0.044015, 0.037714, 0.026274, 0.010198, -0.003161, -0.011897, -0.038107
#*# 	  0.046876, 0.065174, 0.070184, 0.096458, 0.100053, 0.100247, 0.100475, 0.099541, 0.094890, 0.083713, 0.080275, 0.071333, 0.061312, 0.054724, 0.045800, 0.037261, 0.022601, 0.007017, -0.000944, -0.022621
#*# 	  0.038886, 0.058998, 0.074107, 0.083681, 0.102411, 0.105583, 0.103579, 0.102730, 0.102946, 0.098965, 0.093487, 0.087022, 0.082254, 0.074986, 0.061374, 0.056634, 0.035088, 0.027153, 0.021432, 0.002102
#*# 	  0.050572, 0.069987, 0.083156, 0.077314, 0.127971, 0.120430, 0.119095, 0.123589, 0.125331, 0.126279, 0.125070, 0.126557, 0.117822, 0.109130, 0.104745, 0.101495, 0.058885, 0.075477, 0.076179, 0.049935
#*# 	  0.068892, 0.090052, 0.114475, 0.127475, 0.145364, 0.146783, 0.151431, 0.158827, 0.161288, 0.108599, 0.116604, 0.128814, 0.171949, 0.171517, 0.168793, 0.161232, 0.160834, 0.152181, 0.155840, 0.134450
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.1
#*# min_x = 10.0
#*# max_x = 287.0
#*# min_y = 10.0
#*# max_y = 287.0
